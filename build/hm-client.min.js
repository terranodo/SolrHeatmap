/*! Angular search created on 06-04-2017 */
!function(){angular.module("SolrHeatmapApp",["templates-components","ui.bootstrap","rzModule","search_components","ui.router"]),angular.module("SolrHeatmapApp").run(function($window){$window.location.href="http://bop.worldmap.harvard.edu/bop/"}).config(function($locationProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode({enabled:!1,requireBase:!1}),$urlRouterProvider.otherwise("/search"),$stateProvider.state({name:"search",url:"/search?time&geo&text&user",component:"search",resolve:{search:function($stateParams,HeatMapSourceGenerator,searchFilter,DateTimeService){searchFilter.setFilter($stateParams)}}})})}(),function(){angular.module("search_buttonPanel_component",[]).directive("buttonPanel",[function(){function link(scope){}return{link:link,restrict:"EA",templateUrl:"components/buttonPanel/buttonPanel.tpl.html",scope:{}}}])}(),function(){angular.module("search_cardwrapper_component",[]).directive("cardWrapper",function(){return{scope:{},transclude:!0,template:'<div class="row component-padding"><div class="col-xs-12 row-box"><ng-transclude></ng-transclude></div></div>'}})}(),function(){angular.module("search_dataverseButton_component",[]).directive("dataverseButton",["HeatMapSourceGenerator","dataverseService",function(HeatMapSourceGenerator,dataverseService){function Link(scope){function sendToDataverse(){dataverseService.dataverseRequest(function(response){vm.response=response,200===response.status?vm.callbackMessage="Dataverse success response":vm.callbackMessage="Url error",angular.element("#dataverseresponse").modal("show")})}var vm=scope;vm.sendToDataverse=sendToDataverse,vm.dataversefn=dataverseService.getDataverse,vm.callbackMessage=""}return{link:Link,restrict:"EA",templateUrl:"components/dataverseButton/dataverseButton.tpl.html",scope:{}}}])}(),function(){angular.module("search_datepicker_component",[]).directive("datePicker",["HeatMapSourceGenerator","searchFilter","DateTimeService",function(HeatMapSourceGenerator,searchFilter,DateTimeService){function datePickerFilterLink(scope){function openStartDate(){vm.startDate.opened=!0,vm.dateOptions.minDate=vm.initialDateOptions.minDate,vm.dateOptions.maxDate=vm.datepickerEndDate}function openEndDate(){vm.endDate.opened=!0,vm.dateOptions.maxDate=vm.initialDateOptions.maxDate,vm.dateOptions.minDate=vm.datepickerStartDate}function onChangeDatepicker(){vm.dateString=DateTimeService.formatDatesToString(vm.datepickerStartDate,vm.datepickerEndDate),performDateSearch()}function stringToStartEndDateArray(dateString){if(!angular.isString(dateString))return null;var dateArray=dateString.split(" TO ");return angular.isString(dateString)&&2===dateArray.length?(dateArray[0]=new Date(dateArray[0].slice(1,11)),dateArray[1]=new Date(dateArray[1].slice(0,10)),"Invalid Date"===dateArray[0]||"Invalid Date"===dateArray[0]?null:dateArray):null}function changeDatepicker(){var dateArray=stringToStartEndDateArray(vm.dateString);return null!==dateArray?(vm.datepickerStartDate=dateArray[0],vm.datepickerEndDate=dateArray[1],!0):(vm.dateString=DateTimeService.formatDatesToString(vm.datepickerStartDate,vm.datepickerEndDate),!1)}function onSubmitDateText(){var hasDatepickerChanged=changeDatepicker();hasDatepickerChanged&&performDateSearch()}function performDateSearch(){searchFilter.setFilter({time:vm.dateString}),HeatMapSourceGenerator.search()}var vm=scope;vm.dateOptions=searchFilter,vm.dateOptions.startingDate=1,vm.dateOptions.showWeeks=!1,vm.initialDateOptions={minDate:vm.dateOptions.minDate,maxDate:vm.dateOptions.maxDate},vm.$watch(function(){return vm.dateOptions.time},function(newValue,oldValue){angular.isString(newValue)&&(vm.dateString=newValue,changeDatepicker())}),vm.startDate={opened:!1},vm.endDate={opened:!1},vm.datepickerStartDate=vm.dateOptions.minDate,vm.datepickerEndDate=vm.dateOptions.maxDate,vm.onChangeDatepicker=onChangeDatepicker,vm.openEndDate=openEndDate,vm.openStartDate=openStartDate,vm.onSubmitDateText=onSubmitDateText}return{link:datePickerFilterLink,templateUrl:"components/datepicker/datepicker.tpl.html",restrict:"EA",scope:{}}}])}(),function(){angular.module("search_exportButton_component",[]).directive("exportButton",["HeatMapSourceGenerator",function(HeatMapSourceGenerator){function ExportLink(scope){scope.startExport=function(){HeatMapSourceGenerator.startCsvExport()}}return{link:ExportLink,restrict:"EA",template:'<button class="btn btn-default from-panel" id="exportbtn" style="border-top-left-radius: 0;border-bottom-left-radius: 0;"title="EXPORT" type="button" ng-click="startExport()">EXPORT</button>',scope:{}}}])}(),function(){angular.module("search_geospatialFilter_component",[]).directive("geospatialFilter",["searchFilter","HeatMapSourceGenerator","Map",function(searchFilter,HeatMapSourceGenerator,Map){function GeospatialFilterLink(scope){scope.filter=searchFilter,scope.updateFilterString=function(str){scope.filter.geo=str},scope.search=function(){Map.updateTransformationLayerFromQueryForMap(this.filter.geo),HeatMapSourceGenerator.search()}}return{link:GeospatialFilterLink,restrict:"EA",templateUrl:"components/geospatialFilter/geospatialFilter.tpl.html",scope:{}}}])}(),function(){function heatmap(){return{restrict:"EA",templateUrl:"components/heatmap/heatmap.tpl.html",scope:{}}}angular.module("search_heatmap_component",[]).directive("heatmap",heatmap)}(),function(){angular.module("search_timehistogram_component",[]).directive("timeHistogram",["$rootScope","HeatMapSourceGenerator","searchFilter","DateTimeService","NumberService",function($rootScope,HeatMapSourceGenerator,searchFilter,DateTimeService,NumberService){function link(scope,element,attr){function makeHistogram(histogram){function findHistogramMaxValue(){histogram.maxValue=Math.max.apply(null,histogram.counts.map(function(obj){return obj.count}))}function getDimensions(){return{barsheight:barsheight,histogrambarsWidth:histogrambarsWidth,paddingBar:paddingBar,counts:histogram.counts,gap:histogram.gap,maxValue:histogram.maxValue}}function renderingSvgBars(minValue,maxValue){function renderSvgBar(bar,barKey){var height=0===histogram.maxValue?0:barsheight*bar.count/histogram.maxValue,y=barsheight-height,translate=rectWidth*barKey,color=getColor(barKey,minValue,maxValue);return'<g transform="translate('+translate+', 0)">  <rect width="'+rectWidth+'" height="'+height+'" y="'+y+'" fill="'+color+'"></rect></g>'}function getColor(barkey,minvalue,maxvalue){return barkey>=minvalue&&barkey<=maxvalue?"#88b5dd":"#E3E3E3"}if(histogram.counts){minValue=minValue||0,maxValue=maxValue||histogram.counts.length-1,histogram.bars=document.getElementById(scope.barId);var rectWidth=(histogrambarsWidth-2*paddingBar)/histogram.counts.length,svgRect=histogram.counts.map(renderSvgBar);histogram.bars.innerHTML='<svg style="padding-left:'+paddingBar+'px" width="100%" height="'+barsheight+'">'+svgRect.join("")+"</svg>"}}var barsheight=54,histogrambarsWidth=350,paddingBar=8;return findHistogramMaxValue(),{renderingSvgBars:renderingSvgBars,dimensions:getDimensions()}}function setHistogram(event,dataHistogram){if(!dataHistogram.counts.length)return void disableSlider(!0);dataHistogram.counts=generateAllDates(dataHistogram.counts),disableSlider(!1);var firstDate=new Date(dataHistogram.counts[0].value),lastDate=new Date(dataHistogram.counts[dataHistogram.counts.length-1].value);1===vm.slider.options.ceil||isTheInitialDate()||dataHistogram.counts.length-1>vm.slider.options.ceil?(vm.slider.counts=dataHistogram.counts,vm.slider.options.ceil=dataHistogram.counts.length-1,vm.slider.maxValue=vm.slider.options.ceil,vm.slider.minValue=0,dataHistogram.slider=vm.slider,$rootScope.$broadcast("setHistogramRangeSlider",dataHistogram)):dataHistogram.counts.length-1<=vm.slider.options.ceil&&!vm.slider.changeTime||vm.slider.oldFirstDate>firstDate||vm.slider.oldLastDate<lastDate?(vm.slider.oldFirstDate=firstDate,vm.slider.oldLastDate=lastDate,dataHistogram.counts=getSubDataHistogram(dataHistogram,vm.slider),$rootScope.$broadcast("setHistogramRangeSlider",dataHistogram)):(vm.slider.changeTime=!1,$rootScope.$broadcast("changeSlider",vm.slider))}function generateAllDates(data){var newData=[],unitOfTime=DateTimeService.getDurationFormatFromGap(searchFilter.gap).duration;return unitOfTime?(data.forEach(function(datetime,index){if(index<data.length-1){var startDate=moment(datetime.value),nextHour=startDate.add(1,unitOfTime),nextDate=moment(data[index+1].value);for(newData.push(datetime);new Date(nextHour.toJSON())<new Date(nextDate.toJSON());)newData.push({count:0,value:nextHour.toJSON()}),nextHour=nextHour.add(1,unitOfTime)}}),newData):data}function getSubDataHistogram(dataHistogram,slider){var index=0,newData=slider.counts.map(function(bar){var barDate=new Date(bar.value);return slider.oldFirstDate>barDate||slider.oldLastDate<barDate||index===dataHistogram.counts.length?bar.count=0:dataHistogram.counts[index]&&(bar.count=dataHistogram.counts[index].count,index++),bar});return newData}function isTheInitialDate(){var initialDate=DateTimeService.formatDatesToString(searchFilter.minDate,searchFilter.maxDate);return initialDate===searchFilter.time}function slideEnded(){solrHeatmapApp.isThereInteraction=!0;var minKey=vm.slider.minValue,maxKey=vm.slider.maxValue;vm.datepickerStartDate=0===minKey?searchFilter.minDate:new Date(vm.slider.counts[minKey].value),vm.datepickerEndDate=maxKey===vm.slider.counts.length-1?searchFilter.maxDate:new Date(vm.slider.counts[maxKey].value),vm.dateString=DateTimeService.formatDatesToString(vm.datepickerStartDate,vm.datepickerEndDate),performDateSearch()}function performDateSearch(){vm.slider.changeTime=!0,searchFilter.setFilter({time:vm.dateString}),HeatMapSourceGenerator.search()}function disableSlider(option){option?(vm.slider.options.disabled=!0,vm.slider.options.getSelectionBarColor=function(){return"#e3e3e3"}):(vm.slider.options.disabled=!1,vm.slider.options.getSelectionBarColor=defaultSliderValue().options.getSelectionBarColor)}function defaultSliderValue(){return{minValue:0,maxValue:1,changeTime:!1,options:{floor:0,ceil:1,step:1,minRange:1,noSwitching:!0,hideLimitLabels:!0,getSelectionBarColor:function(){return"#609dd2"},translate:function(){return""}}}}function createRange(maxValue,partition){if(maxValue<partition)return[];var range=[];partition=partition||1,maxValue=maxValue||0;for(var step=Math.floor(maxValue/partition),i=0;i<=maxValue;i+=step)range.push(NumberService.compactInteger(i));return range}var HistogramBars,vm=scope;vm.barId=attr.barid,vm.histogramBarsDimensions={},vm.yLegendRange=[],vm.slider=defaultSliderValue(),vm.$on("setHistogramRangeSlider",function(even,histogram){HistogramBars=makeHistogram(histogram),HistogramBars.renderingSvgBars(),vm.histogramBarsDimensions=HistogramBars.dimensions,vm.yLegendRange=createRange(vm.histogramBarsDimensions.maxValue,2)}),vm.$on("changeSlider",function(event,slider){HistogramBars.renderingSvgBars(slider.minValue,slider.maxValue)}),vm.$on("setHistogram",setHistogram),vm.$on("slideEnded",slideEnded),vm.Yaxis={value:0,options:{step:1,floor:0,ceil:2,vertical:!0,minRange:1,showTicks:!0,translate:function(){return""},getSelectionBarColor:function(){return"#609dd2"}}}}var directive={templateUrl:"components/histogram/histogram.tpl.html",restrict:"EA",link:link,scope:{}};return directive}])}(),function(){angular.module("search_legendhistogram_component",[]).directive("legendHistogram",["searchFilter","DateTimeService",function(searchFilter,DateTimeService){function legendHistogramLink(scope){function timeBar(dimensions){vm.legendList=[];var countsLength=dimensions.counts.length,partition=5;partition=partition>countsLength?countsLength:partition;for(var delta=countsLength/partition,i=0;i<partition;i++){var index=Math.round(i*delta),date=moment(dimensions.counts[index].value).utc();vm.legendList.push(date.format(DateTimeService.getDurationFormatFromGap(searchFilter.gap).format))}vm.legendWidth=(dimensions.histogrambarsWidth-2*dimensions.paddingBar)/vm.legendList.length,vm.paddingBar=dimensions.paddingBar}var vm=scope;vm.$watch(function(){return vm.dimensions},function(){0!==Object.keys(vm.dimensions).length&&timeBar(vm.dimensions)})}return{templateUrl:"components/histogram/legend.tpl.html",restrict:"EA",link:legendHistogramLink,scope:{dimensions:"="}}}])}(),function(){angular.module("search_keyword_component",[]).directive("keyword",function(){function keywordLink(scope){var vm=scope;vm.removeTag="true"===vm.remove}return{scope:{tag:"@",remove:"@",removefn:"&"},link:keywordLink,templateUrl:"components/keyword/keyword.tpl.html"}})}(),function(){angular.module("search_keywordinput_component",[]).directive("keywordInput",["HeatMapSourceGenerator","searchFilter","$window","filterKeywordService",function(HeatMapSourceGenerator,searchFilter,$window,filterKeywordService){function keywordInputLink(scope){function getKeyboardCodeFromEvent(keyEvt){return $window.event?keyEvt.keyCode:keyEvt.which}function onKeyPress($event){13===getKeyboardCodeFromEvent($event)?vm.doSearch():8===getKeyboardCodeFromEvent($event)&&removeKeyWordFromDeleteKey()}function doSearch(){vm.textSearchInput.value.length&&(vm.filter[vm.text]=concatSearchInput(vm.filter[vm.text],vm.textSearchInput.value),vm.textSearchInput={value:"",previousLength:0}),search()}function concatSearchInput(searchInput,newValue){if(searchInput&&""!==searchInput){var keywordslength=searchInput.split('"="').length;if(1===keywordslength)return'"'+searchInput+'" "'+newValue+'"';if(keywordslength>1)return searchInput+' "'+newValue+'"'}return""===newValue?null:newValue}function keyWordStringToArray(keyWordString){return keyWordString=keyWordString||"",keyWordString.split('"').filter(function(val){return""!==val&&" "!==val})}function removeKeyWord(keyword){var fiterText;vm.filterArray.forEach(function(value){if(value!==keyword)return void(fiterText=concatSearchInput(fiterText,value))}),vm.filter[vm.text]=fiterText,search()}function removeKeyWordFromDeleteKey(){""===vm.textSearchInput.value&&0===vm.textSearchInput.previousLength&&removeKeyWord(vm.filterArray.pop()),vm.textSearchInput.previousLength=vm.textSearchInput.value.length}function addSuggestedKeywordToSearchInput(keyword){vm.textSearchInput.value=keyword,doSearch()}function listenSuggestWords(){vm.$on(vm.listenKeywordEvent,function(event,dataRawKeywords){angular.isArray(dataRawKeywords)||(dataRawKeywords=[]),vm.tagSwitch.disable=!1,vm.suggestedKeywords=dataRawKeywords.filter(filterKeywordService.filter).slice(0,10)})}function toggleSuggestKeywords(){vm.limit&&(vm.filter[vm.limit]=vm.tagSwitch.value?numberKeywords:null,vm.tagSwitch.disable=!0,search())}function search(){try{solrHeatmapApp.isThereInteraction=!0}catch(e){}finally{HeatMapSourceGenerator.search()}}var vm=scope,numberKeywords=vm.numberKeywords||5;vm.filter=searchFilter,vm.filterArray=[],vm.suggestedKeywords=[],vm.textSearchInput={value:"",previousLength:0},vm.focus=!1,vm.tagSwitch={value:!1,disable:!1},vm.doSearch=doSearch,vm.removeKeyWord=removeKeyWord,vm.addSuggestedKeywordToSearchInput=addSuggestedKeywordToSearchInput,vm.onKeyPress=onKeyPress,vm.toggleSuggestKeywords=toggleSuggestKeywords,listenSuggestWords(),vm.$watch(function(){return vm.filter[vm.text]},function(newValue,oldValue){vm.filterArray=keyWordStringToArray(newValue)})}return{link:keywordInputLink,restrict:"EA",templateUrl:"components/keywordInput/keywordInput.tpl.html",scope:{listenKeywordEvent:"@",numberKeywords:"=",limit:"@",text:"@",placeholder:"@"}}}])}(),function(){angular.module("search_modaltweets_component",[]).directive("modalTweets",["Map","queryService","HeatMapSourceGenerator","Normalize","PanelInformationService",function(Map,queryService,HeatMapSourceGenerator,Normalize,PanelInformationService){function modalLink(scope){function createBboxFromCoordinatePoint(centerPoint){var extentGeo=MapService.getCurrentExtent().geo,deltaX=Math.abs(extentGeo.maxX-extentGeo.minX),deltaY=Math.abs(extentGeo.maxY-extentGeo.minY),newExtent={minX:centerPoint[0]-deltaX/2,minY:centerPoint[1]-deltaY/2,maxX:centerPoint[0]+deltaX/2,maxY:centerPoint[1]+deltaY/2},normalizedExtent=Normalize.normalizeExtent([newExtent.minX,newExtent.minY,newExtent.maxX,newExtent.maxY]);return queryService.createQueryFromExtent(MapService.createExtentFromNormalize(normalizedExtent))}var vm=scope,MapService=Map;vm.closestTweets=[],vm.coordinate=[],vm.sendToTweetStatus=PanelInformationService.tweetStatusUrl,vm.$on("mapReady",function(){MapService.getMap().on("click",function(evt){vm.coordinate=ol.proj.toLonLat(evt.coordinate);var extent=createBboxFromCoordinatePoint(vm.coordinate),params={"q.geo":extent,"d.docs.limit":50,"d.docs.sort":"distance"};HeatMapSourceGenerator.simpleSearch(params,function(res){res.data&&angular.isArray(res.data["d.docs"])&&(vm.closestTweets=res.data["d.docs"],angular.element("#closesttweets").modal("show"))})})})}return{link:modalLink,templateUrl:"components/modalTweets/modalTweets.tpl.html",restrict:"EA",scope:{}}}])}(),function(){angular.module("search_components",["search_timehistogram_component","search_legendhistogram_component","search_datepicker_component","search_tweetlist_component","search_tweetpanel_component","search_tweetcounter_component","search_buttonPanel_component","search_toolbarsearch_component","search_userFilter_component","search_geospatialFilter_component","search_resetButton_component","search_exportButton_component","search_heatmap_component","search_keyword_component","search_cardwrapper_component","search_keywordinput_component","search_responsiveLayout_component","search_dataverseButton_component","search_modaltweets_component"])}(),function(){angular.module("search_resetButton_component",[]).directive("resetButton",["HeatMapSourceGenerator","searchFilter","Map",function(HeatMapSourceGenerator,searchFilter,Map){function ResetLink(scope){scope.reset=function(){Map.resetMap(),searchFilter.resetFilter(),HeatMapSourceGenerator.search()}}return{link:ResetLink,restrict:"EA",template:'<button class="btn btn-primary from-panel" id="resetbtn" title="RESET" type="button" ng-click="reset()">RESET</button>',scope:{}}}]).directive("basemapButton",["Map",function(Map){function link(scope){scope.toggleBaseMaps=function(){Map.toggleBaseMaps()}}return{link:link,template:'<button class="btn btn-default from-panel" type="button" ng-click="toggleBaseMaps()">BASEMAPS</button>',scope:{}}}])}(),function(){angular.module("search_responsiveLayout_component",[]).directive("responsiveLayout",["$window",function($window){function responsiveLayoutLink(scope){function checkWidth(width){return!(width>=800&&width<1200)}var vm=scope;vm.fullscreen=checkWidth($window.innerWidth),vm.$watch(function(){return $window.innerWidth},function(newValue,oldValue){vm.fullscreen=checkWidth(newValue)})}return{link:responsiveLayoutLink,restrict:"EA",templateUrl:"components/responsiveView/responsiveView.tpl.html",scope:{}}}])}(),angular.module("SolrHeatmapApp").component("search",function(){}),function(){angular.module("search_toolbarsearch_component",[]).directive("toolbarSearch",[function(){return{restrict:"EA",template:'<keyword-input number-keywords="50" text="text" limit="textLimit"listen-keyword-event="setSuggestWords" placeholder="Enter keyword"></keyword-input>',scope:{}}}])}(),function(){angular.module("search_tweetcounter_component",[]).directive("tweetCounter",[function(){function tweetCounterLink(scope){scope.$on("setCounter",function(e,data){(data<1||!data)&&(data="No results found"),scope.counter=data})}return{link:tweetCounterLink,restrict:"EA",templateUrl:"components/tweetlist/counter.tpl.html",scope:{}}}])}(),function(){angular.module("search_tweetpanel_component",[]).directive("tweetPanel",["PanelInformationService",function(PanelInformationService){function tweetPanelLink(scope){function IsPanelEmpty(){return 0===Object.keys(vm.selectedTweet).length}var vm=scope;vm.selectedTweet=PanelInformationService.selectedTweet,vm.panelEmpty=!0,vm.$watch(function(){return PanelInformationService.selectedTweet},function(newValue,oldValue){vm.selectedTweet=newValue,vm.panelEmpty=IsPanelEmpty()})}return{link:tweetPanelLink,restrict:"EA",templateUrl:"components/tweetlist/tweetPanel.tpl.html",scope:{}}}])}(),function(){angular.module("search_tweetlist_component",[]).directive("tweetlist",["Map","HeightModule","PanelInformationService",function(Map,HeightModule,PanelInformationService){function tweetlistLink(scope){function setTweetList(event,tweetList){vm.tweetList=tweetList?tweetList:[],vm.tweetList.exist=!0,vm.availableHeight=HeightModule.availableHeight()}function selectTweet(tweet){PanelInformationService.selectedTweet=tweet,addCircle(tweet.coord)}function removeAllfeatures(){PanelInformationService.selectedTweet={},MapService.removeAllfeatures()}function addCircle(coordinates){var coordArray;angular.isString(coordinates)&&coordinates.includes(",")&&(coordArray=coordinates.split(",").map(function(val){return Number(val)}),MapService.addCircle([coordArray[1],coordArray[0]],stylePoint))}var vm=scope;vm.tweetList=[],vm.tweetList.exist=!1,vm.selectTweet=selectTweet,vm.removeAllfeatures=removeAllfeatures,vm.availableHeight=HeightModule.availableHeight(),vm.sendToTweetStatus=PanelInformationService.tweetStatusUrl,vm.$on("setTweetList",setTweetList);var stylePoint=new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:"rgba(0,0,255,0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0,0,255,0.9)",width:2})})})}var MapService=Map;return{link:tweetlistLink,restrict:"EA",templateUrl:"components/tweetlist/tweetlist.tpl.html",scope:{}}}])}(),function(){angular.module("search_userFilter_component",[]).directive("userFilter",[function(){return{restrict:"EA",template:'<keyword-input number-keywords="5" text="user" limit="userLimit"listen-keyword-event="setUserSuggestWords" placeholder="@user"></keyword-input>',scope:{}}}])}(),function(){angular.module("SolrHeatmapApp").controller("BackgroundLayerController",["MapService","$scope",function(MapService,$scope){var vm=this;vm.layers={},vm.selectedLayer={},vm.$on("mapReady",function(event,map){vm.layers=map.getLayers().getArray(),vm.selectedLayer={name:vm.getBackgroundLayers()[0].get("name")}}),vm.isBackgroundLayer=function(layer){var isBackgroundLayer=!1;return layer.get("backgroundLayer")&&(isBackgroundLayer=!0),isBackgroundLayer},vm.setBackgroundLayer=function(layer){angular.forEach(vm.getBackgroundLayers(),function(bgLayer){bgLayer===layer?(layer.setVisible(!0),vm.selectedLayer={name:layer.get("name")}):bgLayer.setVisible(!1)})},vm.getBackgroundLayers=function(){var layers=MapService.getMap().getLayers().getArray();return layers.filter(function(l){return!!l.get("backgroundLayer")})}}])}(),function(){angular.module("SolrHeatmapApp").controller("InfoWindowController",function($scope,$uibModalInstance,infoMsg,toolName){$scope.infoMsg=infoMsg,$scope.toolName=toolName,$scope.ok=function(){$uibModalInstance.close()}})}(),function(){angular.module("SolrHeatmapApp").controller("MainController",["Map","HeatMapSourceGenerator","$http","$scope","$location","$rootScope","$stateParams","searchFilter","queryService",function(Map,HeatMapSourceGenerator,$http,$scope,$location,$rootScope,$stateParams,searchFilter,queryService){var MapService=Map,HeatMapSourceGeneratorService=HeatMapSourceGenerator,mapIsMoved=!1,isBackbuttonPressed=!1,vm=this;vm.$state=$stateParams,vm.isThereInteraction=!1,vm.setupEvents=function(){function changeGeoSearch(changeUrl){changeUrl=!(!angular.isUndefined(changeUrl)&&!changeUrl),MapService.checkBoxOfTransformInteraction();var currentExtent=MapService.getCurrentExtentQuery();searchFilter.setFilter({geo:currentExtent.geo,hm:currentExtent.hm}),HeatMapSourceGeneratorService.search(changeUrl)}MapService.getMap().getView().on("change:center",function(evt){mapIsMoved=!mapIsMoved}),MapService.getMap().getView().on("change:resolution",function(evt){vm.isThereInteraction=!0}),MapService.getMap().on("moveend",function(evt){!mapIsMoved&&"[-90,-180 TO 90,180]"!==searchFilter.geo||isBackbuttonPressed?isBackbuttonPressed?(isBackbuttonPressed=!1,HeatMapSourceGeneratorService.search()):(vm.isThereInteraction=!0,mapIsMoved=!1,changeGeoSearch(!1)):(vm.isThereInteraction=!0,changeGeoSearch(),mapIsMoved=!1)});$rootScope.$on("$locationChangeSuccess",function(){if(!vm.isThereInteraction){isBackbuttonPressed=!0;var extent=queryService.getExtentForProjectionFromQuery($location.search().geo,solrHeatmapApp.initMapConf.view.projection);MapService.getMap().getView().fit(extent,MapService.getMapSize())}vm.isThereInteraction=!1})},vm.response=function(response){var data=response?response.data:void 0;if(!data||!data.mapConfig)throw new Error("Could not find the mapConfig");var mapConf=data.mapConfig,appConf=data.appConfig,bopwsConfig=data.bopwsConfig,instructions=data.instructions;solrHeatmapApp.$state.geo&&(mapConf.view.initExtent=mapConf.view.extent,mapConf.view.extent=queryService.getExtentForProjectionFromQuery(solrHeatmapApp.$state.geo,mapConf.view.projection),mapConf.view.extent=MapService.calculateFullScreenExtentFromBoundingBox(mapConf.view.extent)),MapService.init({mapConfig:mapConf}),solrHeatmapApp.appConfig=appConf,solrHeatmapApp.initMapConf=mapConf,solrHeatmapApp.bopwsConfig=bopwsConfig,solrHeatmapApp.instructions=instructions,$rootScope.$broadcast("mapReady",MapService.getMap()),solrHeatmapApp.setupEvents()},vm.badResponse=function(data){throw new Error("Error while loading the config.json")},solrHeatmapApp=vm,$http.get("./config/appConfig.json").then(solrHeatmapApp.response,solrHeatmapApp.badResponse)}])}(),function(){angular.module("SolrHeatmapApp").factory("DataCacheService",["$window",function($window){function insertData(objkey,objValue){var stringObjKey=angular.toJson(objkey),stringObjValue=angular.toJson(objValue);return $window.localStorage.setItem(stringObjKey,stringObjValue),!0}function getObjData(objKey){var dataObj,stringObjKey=angular.toJson(objKey),stringObjValue=$window.localStorage.getItem(stringObjKey)||!1;try{dataObj=angular.fromJson(stringObjValue)}catch(e){dataObj=null}finally{return dataObj}}function localStorageSpace(){var data="";for(var key in $window.localStorage)$window.localStorage.hasOwnProperty(key)&&(data+=$window.localStorage[key])}return{insertData:insertData,getObjData:getObjData,localStorageSpace:localStorageSpace}}])}(),function(){angular.module("SolrHeatmapApp").factory("dataverseService",["$rootScope","$http",function($rootScope,$http){function prepareDataverseUrl(){var dv=dataverse;if(dv.AllowDataverseDeposit){var urlArray=[dv.dataverseDepositUrl,dv.subsetRetrievalUrl,paramsToString(dv.parameters)];return urlArray.join("?")}return!1}function paramsToString(params){var stringParams=[];for(var key in params)stringParams.push(key+"="+params[key]);return stringParams.join("&")}function dataverseRequest(callback){var config={url:prepareDataverseUrl(),method:"GET"};$http(config).then(function(response){return callback(response)},function(response){return callback(response)})}var dataverse={AllowDataverseDeposit:!1};$rootScope.$on("mapReady",function(even,_){dataverse=solrHeatmapApp.bopwsConfig.dataverse});return{getDataverse:function(){return dataverse},prepareDataverseUrl:prepareDataverseUrl,dataverseRequest:dataverseRequest}}])}(),function(){angular.module("SolrHeatmapApp").factory("DateTimeService",[function(){function formatDatesToString(minDate,maxDate){return"["+minDate.toISOString().replace(".000Z","")+" TO "+maxDate.toISOString().replace(".000Z","")+"]"}function getDurationFormatFromGap(gap){var obj=[];return"PT1H"===gap?obj=["MMM.D.H[h]","hours"]:"P1D"===gap?obj=["MMM-DD","days"]:"P1W"===gap||"P7D"===gap?obj=["YYYY-MMM","weeks"]:"P1M"===gap?obj=["YYYY-MMM","months"]:"P1Y"===gap&&(obj=["YYYY","years"]),{format:obj[0],duration:obj[1]}}function getGapFromTimeString(timeString){if(timeString){var gap,partition=80,dates=formatStringToDates(timeString),diffms=moment(dates[1]).diff(dates[0]),hours=diffms/36e5,days=hours/24,years=days/365,months=12*years;return gap=hours<=partition?"PT1H":days<=partition?"P1D":days/7<=partition?"P1W":months<=partition?"P1M":"P1Y"}}function formatStringToDates(stringDates){var dates=stringDates.split(" TO ");return dates[0]=dates[0].slice(1),dates[1]=dates[1].slice(0,-1),dates}var service={formatDatesToString:formatDatesToString,getDurationFormatFromGap:getDurationFormatFromGap,getGapFromTimeString:getGapFromTimeString};return service}])}(),function(){angular.module("SolrHeatmapApp").factory("filterKeywordService",[function(){function filter(keywordObj){return keywordObj.value.length>=3&&!iskeywordInTheBlacklist(keywordObj.value)}function iskeywordInTheBlacklist(comparedWord){var blacklist=["t.co","https","http","in","at","i'm","a","to","for","the","this","and","you","de","our","with","of","we're","be","on","i","w","la","amp","is","my","en","que","by","me","y","ca","it","if","el","do","1","no","from","you're","e","c","up","o","del","los","that"],comparedList=blacklist.filter(function(blackWord){return blackWord===comparedWord});return 0!==comparedList.length}return{filter:filter}}])}(),function(){angular.module("SolrHeatmapApp").factory("HeatMapSourceGenerator",["Map","$rootScope","$controller","$filter","$log","$document","$q","$http","$state","searchFilter","DateTimeService","DataCacheService",function(Map,$rootScope,$controller,$filter,$log,$document,$q,$http,$state,searchFilter,DateTimeService,DataCacheService){function simpleSearch(params,callback){var sF=searchFilter;params["q.text"]=sF.text,params["q.user"]=sF.user,params["q.time"]=timeTextFormat(sF.time,sF.minDate,sF.maxDate),canceler.resolve(),canceler=$q.defer();var config={url:solrHeatmapApp.appConfig.tweetsSearchBaseUrl,method:"GET",params:params,timeout:canceler.promise};$http(config).then(function(response){return callback(response)})}function createParamsForGeospatialSearch(){var sF=searchFilter;return{"q.text":sF.text,"q.user":sF.user,"q.time":timeTextFormat(sF.time,sF.minDate,sF.maxDate),"q.geo":sF.geo,"a.hm.filter":sF.hm,"a.time.limit":"1","a.time.gap":sF.gap,"d.docs.limit":sF.numOfDocs,"a.text.limit":sF.textLimit,"a.user.limit":sF.userLimit,"d.docs.sort":"distance"}}function setUrlwithParams(params){$state.go("search",{text:params["q.text"],user:params["q.user"],time:params["q.time"],geo:params["q.geo"]},{})}function search(changeUrl){var config,params=createParamsForGeospatialSearch();changeUrl=!(!angular.isUndefined(changeUrl)&&!changeUrl),params?(canceler.resolve(),canceler=$q.defer(),params["a.hm.limit"]=solrHeatmapApp.bopwsConfig.heatmapFacetLimit,config={url:solrHeatmapApp.appConfig.tweetsSearchBaseUrl,method:"GET",params:params,timeout:canceler.promise},$http(config).then(function(response){changeUrl&&setUrlwithParams(params);var data=response.data;broadcastData(data)},function(response){$log.error("An error occured while reading heatmap data")})["catch"](function(){$log.error("An error occured while reading heatmap data")})):$log.error("Spatial filter could not be computed.")}function broadcastData(data){data["a.text"]=data["a.text"]||[],data&&data["a.hm"]&&(MapService.createOrUpdateHeatMapLayer(data["a.hm"]),$rootScope.$broadcast("setCounter",data["a.matchDocs"]),$rootScope.$broadcast("setHistogram",data["a.time"]),$rootScope.$broadcast("setTweetList",data["d.docs"]),$rootScope.$broadcast("setSuggestWords",data["a.text"]),$rootScope.$broadcast("setUserSuggestWords",data["a.user"]))}function startCsvExport(numberOfDocuments){var config,params=createParamsForGeospatialSearch();params?(params["d.docs.limit"]=angular.isNumber(numberOfDocuments)?numberOfDocuments:solrHeatmapApp.bopwsConfig.csvDocsLimit,config={url:solrHeatmapApp.appConfig.tweetsExportBaseUrl,method:"GET",params:params},$http(config).then(function(response){var anchor=angular.element("<a/>");anchor.css({display:"none"}),angular.element($document.body).append(anchor),anchor.attr({href:"data:attachment/csv;charset=utf-8,"+encodeURI(response.data),target:"_blank",download:"bop_export.csv"})[0].click(),anchor.remove()},function(response){$log.error("An error occured while exporting csv data");
})["catch"](function(){$log.error("An error occured while exporting csv data")})):$log.error("Spatial filter could not be computed.")}function timeTextFormat(textDate,minDate,maxDate){return null===textDate?DateTimeService.formatDatesToString(minDate,maxDate):textDate}var MapService=Map,canceler=$q.defer();return{startCsvExport:startCsvExport,search:search,simpleSearch:simpleSearch}}])}(),function(){angular.module("SolrHeatmapApp").factory("HeightModule",["$window",function($window){function documentHeight(){var D=document;return Math.max(D.body.offsetHeight,D.documentElement.offsetHeight,D.body.clientHeight,D.documentElement.clientHeight)}function topPanelHeight(){return $window.innerWidth<1200?4:102}function otherHeights(){return $window.innerWidth<1200?560:350}function sideBarWidth(){return $window.innerWidth<800?4:400}function availableHeight(){return documentHeight()-service.otherHeights()}function calculateNumberofItems(){var height=availableHeight();return height>0?Math.round(height/service.itemHeight):10}var service={itemHeight:90,otherHeights:otherHeights,sideBarWidth:sideBarWidth,rightSideBarWidth:4,bottomHeight:4,topPanelHeight:topPanelHeight,documentHeight:documentHeight,availableHeight:availableHeight,getNumberofItems:calculateNumberofItems};return service}])}(),function(){angular.module("SolrHeatmapApp").factory("Map",["$rootScope","$filter","$document","Normalize","$controller","queryService","HeightModule","$window",function($rootScope,$filter,$document,Normalize,$controller,queryService,HeightModule,$window){function buildMapLayers(layerConfig){var layer,layers=[];return angular.isArray(layerConfig)&&angular.forEach(layerConfig,function(conf){"googleLayer"===conf.type&&(service.googleLayer=new olgm.layer.Google({backgroundLayer:conf.visible,mapTypeId:google.maps.MapTypeId.TERRAIN}),layer=service.googleLayer),"Toner"===conf.type&&(service.tonerLayer=new ol.layer.Tile({source:new ol.source.Stamen({layer:"toner-lite"}),backgroundLayer:conf.backgroundLayer,visible:conf.visible}),layer=service.tonerLayer),"TileWMS"===conf.type&&(layer=new ol.layer.Tile({name:conf.name,backgroundLayer:conf.backgroundLayer,displayInLayerPanel:conf.displayInLayerPanel,source:new ol.source.TileWMS({attributions:[new ol.Attribution({html:conf.attribution})],crossOrigin:conf.crossOrigin,logo:conf.logo,params:conf.params,ratio:conf.ratio,resolutions:conf.resoltions,url:conf.url}),opacity:conf.opacity,visible:conf.visible})),"ImageWMS"===conf.type&&(layer=new ol.layer.Image({name:conf.name,backgroundLayer:conf.backgroundLayer,displayInLayerPanel:conf.displayInLayerPanel,source:new ol.source.ImageWMS({attributions:[new ol.Attribution({html:conf.attribution})],crossOrigin:conf.crossOrigin,logo:conf.logo,params:conf.params,resolutions:conf.resoltions,url:conf.url}),opacity:conf.opacity,visible:conf.visible})),layers.push(layer)}),layers}function fillNullValueToEmptyArray(heatmap){return heatmap.map(function(row){return null===row?[]:row})}function rescaleHeatmapValue(value,minMaxValue){if(null===value)return 0;if(value===-1)return-1;if(0===value)return 0;if(minMaxValue[1]-minMaxValue[0]===0)return 0;var scaledValue=(value-minMaxValue[0])/(minMaxValue[1]-minMaxValue[0]);return scaledValue}function getClassifications(hmParams){var flattenCount=[];hmParams.counts_ints2D.forEach(function(row){flattenCount.push.apply(flattenCount,row)});var series=new geostats(flattenCount),numberOfClassifications=hmParams.gradientArray.length-5;return series.getClassJenks(numberOfClassifications)}function closestValue(arrayOfValues,value){for(var currValue=arrayOfValues[0],currIndex=0,i=1;i<arrayOfValues.length;i++)Math.abs(value-arrayOfValues[i])<Math.abs(value-currValue)&&(currValue=arrayOfValues[i],currIndex=i);return currIndex}function createHeatMapSource(hmParams){var minMaxValue,classifications,olVecSrc,counts_ints2D=hmParams.counts_ints2D,gridColumns=(hmParams.gridLevel,hmParams.columns),gridRows=hmParams.rows,minX=hmParams.minX,minY=hmParams.minY,maxX=hmParams.maxX,maxY=hmParams.maxY,hmProjection=hmParams.projection,dx=maxX-minX,dy=maxY-minY,sx=dx/gridColumns,sy=dy/gridRows,olFeatures=[];if(!counts_ints2D)return null;counts_ints2D=fillNullValueToEmptyArray(counts_ints2D),classifications=getClassifications(hmParams),minMaxValue=[0,classifications.length-1];for(var i=0;i<gridRows;i++)for(var j=0;j<gridColumns;j++){var lon,lat,feat,coords,hmVal=counts_ints2D[counts_ints2D.length-i-1][j];if(hmVal&&null!==hmVal){lat=minY+i*sy+.5*sy,lon=minX+j*sx+.5*sx,coords=ol.proj.transform([lon,lat],hmProjection,map.getView().getProjection().getCode());var classifiedValue=closestValue(classifications,hmVal),scaledValue=rescaleHeatmapValue(classifiedValue,minMaxValue);feat=new ol.Feature({name:hmVal,scaledValue:scaledValue,geometry:new ol.geom.Point(coords),opacity:1,weight:1}),feat.set("weight",scaledValue),feat.set("origVal",hmVal),olFeatures.push(feat)}}return olVecSrc=new ol.source.Vector({features:olFeatures,useSpatialIndex:!0})}function displayTooltip(evt,overlay,tooltip){var pixel=evt.pixel,feature=map.forEachFeatureAtPixel(pixel,function(feat){return feat}),name=feature?feature.get("name"):void 0;tooltip.style.display=name?"":"none",name&&(overlay.setPosition(evt.coordinate),tooltip.innerHTML=name)}function generateMaskAndAssociatedInteraction(bboxFeature,fromSrs){var polygon=new ol.Feature(ol.geom.Polygon.fromExtent(bboxFeature));service.getLayersBy("backgroundLayer",!0)[0];if(fromSrs!==service.getMapProjection()){var polygonNew=ol.proj.transformExtent(bboxFeature,fromSrs,service.getMapProjection());polygon=new ol.Feature(ol.geom.Polygon.fromExtent(polygonNew))}var vector=new ol.layer.Vector({name:"TransformInteractionLayer",source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:[255,255,255,0]}),stroke:new ol.style.Stroke({color:[0,0,0,0],width:0})})});service.getMap().addLayer(vector),vector.getSource().addFeature(polygon)}function setTransactionBBox(extent){var polyNew,transformationLayer=service.getLayersBy("name","TransformInteractionLayer")[0],vectorSrc=transformationLayer.getSource(),currentBbox=vectorSrc.getFeatures()[0];polyNew=ol.geom.Polygon.fromExtent(extent),currentBbox.setGeometry(polyNew)}var NormalizeService=Normalize,service={},map={},defaults={renderer:"canvas",view:{center:[0,0],projection:"EPSG:3857",zoom:2}};service.getMap=function(){return map},service.getMapView=function(){return service.getMap().getView()},service.getMapZoom=function(){return service.getMapView().getZoom()},service.getMapSize=function(){return service.getMap().getSize()},service.getMapProjection=function(){return service.getMapView().getProjection().getCode()},service.getLayers=function(){return service.getMap().getLayers().getArray()},service.getInteractions=function(){return service.getMap().getInteractions().getArray()},service.getLayersBy=function(key,value){var layers=service.getLayers();return layers.filter(function(layer){return layer.get(key)===value})},service.getInteractionsByClass=function(value){var interactions=service.getInteractions();return $filter("filter")(interactions,function(interaction){return interaction instanceof value})},service.getInteractionsByType=function(interactions,type){return $filter("filter")(interactions,function(interaction){return interaction.type_===type})},service.updateTransformationLayerFromQueryForMap=function(query){var extent=queryService.getExtentForProjectionFromQuery(query,service.getMapProjection());setTransactionBBox(extent)};return service.createOrUpdateHeatMapLayer=function(hmData){var existingHeatMapLayers,transformInteractionLayer,olVecSrc,newHeatMapLayer;if(hmData.heatmapRadius=20,hmData.blur=6,hmData.gradientArray=["#000000","#0000df","#0000df","#00effe","#00effe","#00ff42"," #00ff42","#00ff42","#feec30","#ff5f00","#ff0000"],existingHeatMapLayers=service.getLayersBy("name","HeatMapLayer"),transformInteractionLayer=service.getLayersBy("name","TransformInteractionLayer")[0],olVecSrc=createHeatMapSource(hmData),existingHeatMapLayers&&existingHeatMapLayers.length>0){var currHeatmapLayer=existingHeatMapLayers[0],layerSrc=currHeatmapLayer.getSource();layerSrc&&layerSrc.clear(),currHeatmapLayer.setSource(olVecSrc)}else{newHeatMapLayer=new ol.layer.Heatmap({name:"HeatMapLayer",source:olVecSrc,radius:hmData.heatmapRadius,blur:hmData.blur,gradient:hmData.gradientArray});try{service.getMap().addLayer(newHeatMapLayer)}catch(err){}}},service.calculateReducedBoundingBoxFromInFullScreen=function(extent){var sideBarPercent=1-HeightModule.sideBarWidth()/$window.innerWidth,rightSideBarWidth=1-HeightModule.rightSideBarWidth/$window.innerWidth,bottomHeight=1-HeightModule.bottomHeight/$window.innerWidth,topBarPercent=1-HeightModule.topPanelHeight()/HeightModule.documentHeight();if(solrHeatmapApp.appConfig){var dx=extent.maxX-extent.minX,dy=extent.maxY-extent.minY,minX=extent.minX+(1-sideBarPercent)*dx,maxX=extent.minX+rightSideBarWidth*dx,minY=extent.minY+(1-bottomHeight)*dy,maxY=extent.minY+topBarPercent*dy;return{minX:minX,minY:minY,maxX:maxX,maxY:maxY}}return extent},service.calculateFullScreenExtentFromBoundingBox=function(extent){extent={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3]};var sideBarPercent=1-HeightModule.sideBarWidth()/$window.innerWidth,topBarPercent=1-HeightModule.topPanelHeight()/HeightModule.documentHeight(),dx=extent.maxX-extent.minX,dy=extent.maxY-extent.minY,minX=extent.minX+dx-dx/sideBarPercent,maxY=extent.minY+dy/topBarPercent;return[minX,extent.minY,extent.maxX,maxY]},service.checkBoxOfTransformInteraction=function(){var mapExtent=service.getMapView().calculateExtent(service.getMapSize()),reducedBoundingBox=service.calculateReducedBoundingBoxFromInFullScreen({minX:mapExtent[0],minY:mapExtent[1],maxX:mapExtent[2],maxY:mapExtent[3]});setTransactionBBox([reducedBoundingBox.minX,reducedBoundingBox.minY,reducedBoundingBox.maxX,reducedBoundingBox.maxY])},service.resetMap=function(){var intitalCenter=solrHeatmapApp.initMapConf.view.center,intitalZoom=solrHeatmapApp.initMapConf.view.zoom;if(intitalZoom&&intitalCenter){var vw=service.getMapView();vw.setCenter(intitalCenter),vw.setZoom(intitalZoom),service.checkBoxOfTransformInteraction()}},service.getReducedQueryFromExtent=function(extentQuery){var extent=queryService.getExtentFromQuery(extentQuery);return queryService.createQueryFromExtent(service.calculateReducedBoundingBoxFromInFullScreen(extent))},service.getCurrentExtentQuery=function(){var currentExtent=service.getCurrentExtent();return{geo:queryService.createQueryFromExtent(currentExtent.geo),hm:queryService.createQueryFromExtent(currentExtent.hm)}},service.createExtentFromNormalize=function(normalizedExtent){return{minX:normalizedExtent[0],minY:normalizedExtent[1],maxX:normalizedExtent[2],maxY:normalizedExtent[3]}},service.getCurrentExtent=function(){var currentBbox,currentBboxExtentWgs84,viewProj=service.getMapProjection(),extent=service.getMapView().calculateExtent(service.getMapSize()),extentWgs84=ol.proj.transformExtent(extent,viewProj,"EPSG:4326"),transformInteractionLayer=service.getLayersBy("name","TransformInteractionLayer")[0],currentExtent={},currentExtentBox={};if(!transformInteractionLayer)return null;if(currentBbox=transformInteractionLayer.getSource().getFeatures()[0],currentBboxExtentWgs84=ol.proj.transformExtent(currentBbox.getGeometry().getExtent(),viewProj,"EPSG:4326"),service.getMapZoom()<=1&&(extentWgs84=[-180,-90,180,90]),extent&&extentWgs84){var normalizedExtentMap=NormalizeService.normalizeExtent(extentWgs84),normalizedExtentBox=NormalizeService.normalizeExtent(currentBboxExtentWgs84);currentExtent=service.createExtentFromNormalize(normalizedExtentMap),currentExtentBox=service.createExtentFromNormalize(normalizedExtentBox);var roundToFixed=function(value){return parseFloat(Math.round(100*value)/100).toFixed(2)};$rootScope.$broadcast("geoFilterUpdated","["+roundToFixed(currentExtentBox.minX)+","+roundToFixed(currentExtentBox.minY)+" TO "+roundToFixed(currentExtentBox.maxX)+","+roundToFixed(currentExtentBox.maxY)+"]")}return{hm:currentExtent,geo:currentExtentBox}},service.removeAllfeatures=function(){if(angular.isObject(map)){var layersWithBbox=service.getLayersBy("isbbox",!0);layersWithBbox[0].getSource().clear()}},service.addCircle=function(point,style){var geojsonObject={type:"Feature",geometry:{type:"Point",coordinates:ol.proj.fromLonLat(point)}};if(angular.isObject(map)&&0!==Object.keys(map).length){var layersWithBbox=service.getLayersBy("isbbox",!0),features=(new ol.format.GeoJSON).readFeatures(geojsonObject);if(layersWithBbox.length)layersWithBbox[0].getSource().addFeatures(features);else{var vectorLayer=new ol.layer.Vector({isbbox:!0,source:new ol.source.Vector({features:features})});vectorLayer.setStyle(style),map.addLayer(vectorLayer)}}},service.toggleBaseMaps=function(){service.googleLayer.setVisible(!service.googleLayer.getVisible()),service.tonerLayer.setVisible(!service.tonerLayer.getVisible())},service.init=function(config){var viewConfig=angular.extend(defaults.view,config.mapConfig.view),rendererConfig=config.mapConfig.renderer?config.mapConfig.renderer:defaults.renderer,layerConfig=config.mapConfig.layers;map=new ol.Map({interactions:olgm.interaction.defaults(),controls:ol.control.defaults().extend([new ol.control.ScaleLine,new ol.control.ZoomSlider]),layers:buildMapLayers(layerConfig),renderer:angular.isString(rendererConfig)?rendererConfig:void 0,target:"map",view:new ol.View({center:angular.isArray(viewConfig.center)?viewConfig.center:void 0,maxZoom:angular.isNumber(viewConfig.maxZoom)?viewConfig.maxZoom:void 0,minZoom:angular.isNumber(viewConfig.minZoom)?viewConfig.minZoom:void 0,projection:angular.isString(viewConfig.projection)?viewConfig.projection:void 0,resolution:angular.isString(viewConfig.resolution)?viewConfig.resolution:void 0,resolutions:angular.isArray(viewConfig.resolutions)?viewConfig.resolutions:void 0,rotation:angular.isNumber(viewConfig.rotation)?viewConfig.rotation:void 0,zoom:angular.isNumber(viewConfig.zoom)?viewConfig.zoom:void 0,zoomFactor:angular.isNumber(viewConfig.zoomFactor)?viewConfig.zoomFactor:void 0})});var olGM=new olgm.OLGoogleMaps({map:map});if(olGM.activate(),angular.isArray(viewConfig.extent)){var vw=map.getView();vw.set("extent",viewConfig.extent),generateMaskAndAssociatedInteraction(viewConfig.extent,viewConfig.projection),viewConfig.initExtent&&vw.fit(viewConfig.extent,service.getMapSize())}var tooltip=$window.document.getElementById("tooltip"),overlay=new ol.Overlay({element:tooltip,offset:[10,0],positioning:"bottom-left"});map.addOverlay(overlay),map.on("pointermove",function(evt){displayTooltip(evt,overlay,tooltip)})},service}])}(),function(){angular.module("SolrHeatmapApp").factory("Normalize",function(){function clamp(num,min,max){if(max<min){var tmp=min;min=max,max=tmp}return Math.min(Math.max(min,num),max)}function outsideLonRange(lon){return lon<-180||lon>180}function outsideLatRange(lat){return lat<-90||lat>90}function clampLon(lon){return clamp(lon,-180,180)}function clampLat(lat){return clamp(lat,-90,90)}function normalize(extent){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],width=Math.min(maxX-minX,360),height=Math.min(maxY-minY,180),rangeCheck=function(min,max,rangeFunc,clampFunc,extra){return rangeFunc(min)?(min=clampFunc(min),max=min+extra):rangeFunc(max)&&(max=clampFunc(max),min=max-extra),[min,max]},x=rangeCheck(minX,maxX,outsideLonRange,clampLon,width);minX=x[0],maxX=x[1];var y=rangeCheck(minY,maxY,outsideLatRange,clampLat,height);return minY=y[0],maxY=y[1],[minX,minY,maxX,maxY]}return{normalizeExtent:normalize}})}(),function(){angular.module("SolrHeatmapApp").factory("NumberService",[function(){function compactInteger(input,decimals){decimals=decimals||0,decimals=Math.max(decimals,0);var number=parseInt(input,10),signString=number<0?"-":"",unsignedNumber=Math.abs(number),unsignedNumberString=String(unsignedNumber),numberLength=unsignedNumberString.length,numberLengths=[13,10,7,4],bigNumPrefixes=["T","B","M","k"];if(unsignedNumber<1e3)return signString+unsignedNumberString;if(numberLength>numberLengths[0]+3)return number.toExponential(decimals).replace("e+","x10^");for(var length,i=0;i<numberLengths.length;i++){var _length=numberLengths[i];if(numberLength>=_length){length=_length;break}}var decimalIndex=numberLength-length+1,unsignedNumberCharacterArray=unsignedNumberString.split(""),wholePartArray=unsignedNumberCharacterArray.slice(0,decimalIndex),decimalPartArray=unsignedNumberCharacterArray.slice(decimalIndex,decimalIndex+decimals+1),wholePart=wholePartArray.join(""),decimalPart=decimalPartArray.join("");decimalPart.length<decimals&&(decimalPart+=Array(decimals-decimalPart.length+1).join("0"));var output;if(0===decimals)output=signString+wholePart+bigNumPrefixes[numberLengths.indexOf(length)];else{var outputNumber=Number(wholePart+"."+decimalPart).toFixed(decimals);output=signString+outputNumber+bigNumPrefixes[numberLengths.indexOf(length)]}return output}return{compactInteger:compactInteger}}])}(),function(){angular.module("SolrHeatmapApp").factory("PanelInformationService",["$window",function($window){function tweetStatusUrl(tweetInfo){var url="https://twitter.com/"+tweetInfo.user_name+"/status/"+tweetInfo.id;$window.open(url,"_blank")}var service={selectedTweet:{},tweetStatusUrl:tweetStatusUrl};return service}])}(),function(){angular.module("SolrHeatmapApp").factory("queryService",["Normalize",function(Normalize){var service={};return service.createQueryFromExtent=function(extent){return"["+extent.minY+","+extent.minX+" TO "+extent.maxY+","+extent.maxX+"]"},service.getExtentFromQuery=function(query){var extent,min,max,extentSplit=function(extentString){return extentString.split(",")};return extent=query.replace(/\[|\]/g,"").split(" TO "),min=extentSplit(extent[0]),max=extentSplit(extent[1]),{minX:parseInt(min[0],10),minY:parseInt(min[1],10),maxX:parseInt(max[0],10),maxY:parseInt(max[1],10)}},service.getExtentForProjectionFromQuery=function(query,projection){var extentObj=service.getExtentFromQuery(query),extent=Normalize.normalizeExtent([extentObj.minY,extentObj.minX,extentObj.maxY,extentObj.maxX]);return ol.proj.transformExtent(extent,"EPSG:4326",projection)},service}])}(),function(){angular.module("SolrHeatmapApp").factory("searchFilter",["Map","HeightModule","DateTimeService",function(Map,HeightModule,DateTimeService){var MapService=Map,service={geo:"[-90,-180 TO 90,180]",hm:"[-90,-180 TO 90,180]",time:null,text:null,user:null,textLimit:null,userLimit:null,numOfDocs:50,gap:"P1W",minDate:new Date(moment().subtract(3,"months").format("YYYY-MM-DD")),maxDate:new Date(moment().format("YYYY-MM-DD"))};return service.setFilter=function(filter){filter.time&&(service.time=filter.time,service.gap=DateTimeService.getGapFromTimeString(filter.time)),filter.user&&(service.user=filter.user),filter.text&&(service.text=filter.text),filter.geo&&(service.geo=filter.geo),filter.hm&&(service.hm=filter.hm)},service.resetFilter=function(){service.time=DateTimeService.formatDatesToString(service.minDate,service.maxDate),service.text=null,service.user=null,service.geo=MapService.getCurrentExtentQuery().geo,service.textLimit=null,service.gap="P1W"},service}])}(),ol.interaction.Transform=function(options){options||(options={});var self=this;ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=options.features,this.layers_=options.layers?options.layers instanceof Array?options.layers:[options.layers]:null,this.set("translateFeature",options.translateFeature!==!1),this.set("translate",options.translate!==!1),this.set("stretch",options.stretch!==!1),this.set("scale",options.scale!==!1),this.set("rotate",options.rotate!==!1),this.on("propertychange",function(){this.drawSketch_()}),this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(feature){return self.style[(feature.get("handle")||"default")+(feature.get("constraint")||"")+(feature.get("option")||"")]}}),this.setDefaultStyle()},ol.inherits(ol.interaction.Transform,ol.interaction.Pointer),ol.interaction.Transform.prototype.Cursors={"default":"auto",select:"pointer",translate:"move",rotate:"move",scale:"ne-resize",scale1:"nw-resize",scale2:"ne-resize",scale3:"nw-resize",scalev:"e-resize",scaleh1:"n-resize",scalev2:"e-resize",scaleh3:"n-resize"},ol.interaction.Transform.prototype.setMap=function(map){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Pointer.prototype.setMap.call(this,map),this.overlayLayer_.setMap(map),this.isTouch=/touch/.test(map.getViewport().className),this.setDefaultStyle()},ol.interaction.Transform.prototype.setActive=function(b){ol.interaction.Pointer.prototype.setActive.call(this,b),b&&this.select(null)},ol.interaction.Transform.prototype.setDefaultStyle=function(){function createStyle(img,stroke,fill){return[new ol.style.Style({image:img,stroke:stroke,fill:fill})]}var stroke=new ol.style.Stroke({color:[255,0,0,1],width:1}),strokedash=new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),fill0=new ol.style.Fill({color:[255,0,0,.01]}),fill=new ol.style.Fill({color:[255,255,255,.8]}),circle=new ol.style.RegularShape({fill:fill,stroke:stroke,radius:this.isTouch?12:6,points:15});circle.getAnchor()[0]=this.isTouch?-10:-5;var bigpt=new ol.style.RegularShape({fill:fill,stroke:stroke,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),smallpt=new ol.style.RegularShape({fill:fill,stroke:stroke,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});this.style={"default":createStyle(bigpt,strokedash,fill0),translate:createStyle(bigpt,stroke,fill),rotate:createStyle(circle,stroke,fill),rotate0:createStyle(bigpt,stroke,fill),scale:createStyle(bigpt,stroke,fill),scale1:createStyle(bigpt,stroke,fill),scale2:createStyle(bigpt,stroke,fill),scale3:createStyle(bigpt,stroke,fill),scalev:createStyle(smallpt,stroke,fill),scaleh1:createStyle(smallpt,stroke,fill),scalev2:createStyle(smallpt,stroke,fill),scaleh3:createStyle(smallpt,stroke,fill)},this.drawSketch_()},ol.interaction.Transform.prototype.setStyle=function(style,olstyle){if(olstyle){olstyle instanceof Array?this.style[style]=olstyle:this.style[style]=[olstyle];for(var i=0;i<this.style[style].length;i++){var im=this.style[style][i].getImage();im&&("rotate"==style&&(im.getAnchor()[0]=-5),this.isTouch&&im.setScale(1.8));var tx=this.style[style][i].getText();tx&&("rotate"==style&&tx.setOffsetX(this.isTouch?14:7),this.isTouch&&tx.setScale(1.8))}this.drawSketch_()}},ol.interaction.Transform.prototype.getFeatureAtPixel_=function(pixel){return this.getMap().forEachFeatureAtPixel(pixel,function(feature,layer){var found=!1;if(!layer){if(feature===this.bbox_)return!1;if(this.handles_.forEach(function(f){f===feature&&(found=!0)}),found)return{feature:feature,handle:feature.get("handle"),constraint:feature.get("constraint"),option:feature.get("option")}}if(this.layers_){for(var i=0;i<this.layers_.length;i++)if(this.layers_[i]===layer)return{feature:feature};return null}return this.features_?(this.features_.forEach(function(f){f===feature&&(found=!0)}),found?{feature:feature}:null):{feature:feature}},this)||{}},ol.interaction.Transform.prototype.drawSketch_=function(center){if(this.overlayLayer_.getSource().clear(),this.feature_)if(center===!0){if(!this.ispt_){this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_),handle:"rotate0"}));var ext=this.feature_.getGeometry().getExtent(),geom=ol.geom.Polygon.fromExtent(ext),f=this.bbox_=new ol.Feature(geom);this.overlayLayer_.getSource().addFeature(f)}}else{var ext=this.feature_.getGeometry().getExtent();if(this.ispt_){var p=this.getMap().getPixelFromCoordinate([ext[0],ext[1]]);ext=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([p[0]-10,p[1]-10]),this.getMap().getCoordinateFromPixel([p[0]+10,p[1]+10])])}var geom=ol.geom.Polygon.fromExtent(ext),f=this.bbox_=new ol.Feature(geom),features=[],g=geom.getCoordinates()[0];if(!this.ispt_){if(features.push(f),this.get("stretch")&&this.get("scale"))for(var i=0;i<g.length-1;i++)f=new ol.Feature({geometry:new ol.geom.Point([(g[i][0]+g[i+1][0])/2,(g[i][1]+g[i+1][1])/2]),handle:"scale",constraint:i%2?"h":"v",option:i}),features.push(f);if(this.get("scale"))for(var i=0;i<g.length-1;i++)f=new ol.Feature({geometry:new ol.geom.Point(g[i]),handle:"scale",option:i}),features.push(f);this.get("translate")&&!this.get("translateFeature")&&(f=new ol.Feature({geometry:new ol.geom.Point([(g[0][0]+g[2][0])/2,(g[0][1]+g[2][1])/2]),handle:"translate"}),features.push(f))}this.get("rotate")&&(f=new ol.Feature({geometry:new ol.geom.Point(g[3]),handle:"rotate"}),features.push(f)),this.overlayLayer_.getSource().addFeatures(features)}},ol.interaction.Transform.prototype.select=function(feature){this.feature_=feature,this.ispt_=!!this.feature_&&"Point"==this.feature_.getGeometry().getType(),this.drawSketch_(),this.dispatchEvent({type:"select",feature:this.feature_})},ol.interaction.Transform.prototype.handleDownEvent_=function(evt){var sel=this.getFeatureAtPixel_(evt.pixel),feature=sel.feature;return this.feature_&&this.feature_==feature&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(sel.handle="translate"),sel.handle?(this.mode_=sel.handle,this.opt_=sel.option,this.constraint_=sel.constraint,this.coordinate_=evt.coordinate,this.pixel_=evt.pixel,this.geom_=this.feature_.getGeometry().clone(),this.extent_=ol.geom.Polygon.fromExtent(this.geom_.getExtent()).getCoordinates()[0],this.center_=ol.extent.getCenter(this.geom_.getExtent()),this.angle_=Math.atan2(this.center_[1]-evt.coordinate[1],this.center_[0]-evt.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.feature_,pixel:evt.pixel,coordinate:evt.coordinate}),!0):(this.feature_=feature,this.ispt_=!!this.feature_&&"Point"==this.feature_.getGeometry().getType(),this.drawSketch_(),this.dispatchEvent({type:"select",feature:this.feature_,pixel:evt.pixel,coordinate:evt.coordinate}),!1)},ol.interaction.Transform.prototype.handleDragEvent_=function(evt){switch(this.mode_){case"rotate":var a=Math.atan2(this.center_[1]-evt.coordinate[1],this.center_[0]-evt.coordinate[0]);if(!this.ispt){var geometry=this.geom_.clone();geometry.rotate(a-this.angle_,this.center_),this.feature_.setGeometry(geometry)}this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.feature_,angle:a-this.angle_,pixel:evt.pixel,coordinate:evt.coordinate});break;case"translate":var deltaX=evt.coordinate[0]-this.coordinate_[0],deltaY=evt.coordinate[1]-this.coordinate_[1];this.feature_.getGeometry().translate(deltaX,deltaY),this.handles_.forEach(function(f){f.getGeometry().translate(deltaX,deltaY)}),this.coordinate_=evt.coordinate,this.dispatchEvent({type:"translating",feature:this.feature_,delta:[deltaX,deltaY],pixel:evt.pixel,coordinate:evt.coordinate});break;case"scale":var center=this.center_;(evt.originalEvent.metaKey||evt.originalEvent.ctrlKey)&&(center=this.extent_[(Number(this.opt_)+2)%4]);var scx=(evt.coordinate[0]-center[0])/(this.coordinate_[0]-center[0]),scy=(evt.coordinate[1]-center[1])/(this.coordinate_[1]-center[1]);this.constraint_?"h"==this.constraint_?scx=1:scy=1:evt.originalEvent.shiftKey&&(scx=scy=Math.min(scx,scy));var geometry=this.geom_.clone();geometry.applyTransform(function(g1,g2,dim){if(dim<2)return g2;for(i=0;i<g1.length;i+=dim)1!=scx&&(g2[i]=center[0]+(g1[i]-center[0])*scx),1!=scy&&(g2[i+1]=center[1]+(g1[i+1]-center[1])*scy);return g2}),this.feature_.setGeometry(geometry),this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.feature_,scale:[scx,scy],pixel:evt.pixel,coordinate:evt.coordinate})}},ol.interaction.Transform.prototype.handleMoveEvent_=function(evt){if(!this.mode_){var sel=(evt.map,this.getFeatureAtPixel_(evt.pixel)),element=evt.map.getTargetElement();if(sel.feature){var c=sel.handle?this.Cursors[(sel.handle||"default")+(sel.constraint||"")+(sel.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=element.style.cursor),element.style.cursor=c}else void 0!==this.previousCursor_&&(element.style.cursor=this.previousCursor_),this.previousCursor_=void 0}},ol.interaction.Transform.prototype.handleUpEvent_=function(evt){return this.dispatchEvent({type:this.mode_+"end",feature:this.feature_,oldgeom:this.geom_}),this.drawSketch_(),this.mode_=null,!1},ol.filter={},ol.filter.Base=function(options){ol.Object.call(this),options&&options.active===!1?this.set("active",!1):this.set("active",!0)},ol.inherits(ol.filter.Base,ol.Object),ol.filter.Base.prototype.setActive=function(b){this.set("active",b===!0)},ol.filter.Base.prototype.getActive=function(b){return this.set("active")},ol.filter.Base.prototype.addFilter_=function(filter){this.filters_||(this.filters_=[]),this.filters_.push(filter),filter.precompose&&this.on("precompose",function(e){filter.get("active")&&filter.precompose(e)},this),filter.postcompose&&this.on("postcompose",function(e){filter.get("active")&&filter.postcompose(e)},this),filter.on("propertychange",function(){this.renderSync?this.renderSync():this.changed()},this)},ol.Map.prototype.addFilter=function(filter){ol.filter.Base.prototype.addFilter_.call(this,filter)},ol.Map.prototype.getFilters=function(){return this.filters_},ol.layer.Base.prototype.addFilter=function(filter){ol.filter.Base.prototype.addFilter_.call(this,filter)},ol.layer.Base.prototype.getFilters=function(){return this.filters_},ol.filter.Mask=function(options){if(options=options||{},ol.filter.Base.call(this,options),options.feature)switch(options.feature.getGeometry().getType()){case"Polygon":case"MultiPolygon":this.feature_=options.feature}this.set("inner",options.inner),this.fillColor_=options.fill?ol.color.asString(options.fill.getColor())||"rgba(0,0,0,0.2)":"rgba(0,0,0,0.2)"},ol.inherits(ol.filter.Mask,ol.filter.Base),ol.filter.Mask.prototype.drawFeaturePath_=function(e,out){function tr(pt){return[(pt[0]*m[0]+pt[1]*m[1]+m[4])*ratio,(pt[0]*m[2]+pt[1]*m[3]+m[5])*ratio]}var ctx=e.context,canvas=ctx.canvas,ratio=e.frameState.pixelRatio,m=e.frameState.coordinateToPixelTransform;m||(m=e.frameState.coordinateToPixelMatrix,tr=function(pt){return[(pt[0]*m[0]+pt[1]*m[1]+m[12])*ratio,(pt[0]*m[4]+pt[1]*m[5]+m[13])*ratio]});var ll=this.feature_.getGeometry().getCoordinates();"Polygon"==this.feature_.getGeometry().getType()&&(ll=[ll]),ctx.beginPath(),out&&(ctx.moveTo(0,0),ctx.lineTo(canvas.width,0),ctx.lineTo(canvas.width,canvas.height),ctx.lineTo(0,canvas.height),ctx.lineTo(0,0));for(var l=0;l<ll.length;l++)for(var c=ll[l],i=0;i<c.length;i++){var pt=tr(c[i][0]);ctx.moveTo(pt[0],pt[1]);for(var j=1;j<c[i].length;j++)pt=tr(c[i][j]),ctx.lineTo(pt[0],pt[1])}},ol.filter.Mask.prototype.postcompose=function(e){if(this.feature_){var ctx=e.context;ctx.save(),this.drawFeaturePath_(e,!this.get("inner")),ctx.fillStyle=this.fillColor_,ctx.fill("evenodd"),ctx.restore()}},angular.module("templates-components",["components/buttonPanel/buttonPanel.tpl.html","components/dataverseButton/dataverseButton.tpl.html","components/datepicker/datepicker.tpl.html","components/geospatialFilter/geospatialFilter.tpl.html","components/heatmap/heatmap.tpl.html","components/histogram/histogram.tpl.html","components/histogram/legend.tpl.html","components/keyword/keyword.tpl.html","components/keywordInput/keywordInput.tpl.html","components/modalTweets/modalTweets.tpl.html","components/responsiveView/responsiveView.tpl.html","components/toolbarSearch/toolbarSearchField.tpl.html","components/tweetlist/counter.tpl.html","components/tweetlist/tweetlist.tpl.html","components/tweetlist/tweetPanel.tpl.html"]),angular.module("components/buttonPanel/buttonPanel.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/buttonPanel/buttonPanel.tpl.html",'<div class="button-panel">\n    <dataverse-button></dataverse-button>\n    <export-button></export-button>\n    <basemap-button></basemap-button>\n    <reset-button></reset-button>\n</div>\n');
}]),angular.module("components/dataverseButton/dataverseButton.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/dataverseButton/dataverseButton.tpl.html",'<button ng-if="dataversefn().AllowDataverseDeposit" class="btn btn-default from-panel"\n    id="dataversebtn" type="button" ng-click="sendToDataverse()">\n    DATAVERSE\n</button>\n\n<!-- Modal -->\n<div class="modal fade" id="dataverseresponse" tabindex="-1">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n        </button>\n        <h3 class="modal-title">\n            Dataverse response\n        </h3>\n      </div>\n      <div class="modal-body">\n            <div>{{callbackMessage}}</div>\n            <a href="{{response.config.url}}" target="_blank">{{response.config.url}}</a>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("components/datepicker/datepicker.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/datepicker/datepicker.tpl.html",'<div class="col-md-12 padding-search">\n        <div class="form-horizontal">\n            <div class="row">\n                <label class="control-label col-xs-2">From</label>\n                <div class="col-xs-4 datepicker-wrapper">\n                    <p class="input-group">\n                        <input type="text" class="form-control input-sm" uib-datepicker-popup ng-model="datepickerStartDate" is-open="startDate.opened"\n                            show-button-bar="false" datepicker-options="dateOptions" ng-required="true"\n                            ng-model-options="{timezone: \'UTC\'}" ng-change="onChangeDatepicker()" readonly/>\n                        <span class="input-group-btn">\n                            <button type="button" class="btn btn-default btn-sm" ng-click="openStartDate()"><i class="glyphicon glyphicon-calendar"></i></button>\n                        </span>\n                    </p>\n                </div>\n                <label class="control-label col-xs-1">To</label>\n                <div class="col-xs-4 datepicker-wrapper">\n                    <p class="input-group">\n                        <input type="text" class="form-control input-sm" uib-datepicker-popup ng-model="datepickerEndDate" is-open="endDate.opened"\n                            show-button-bar="false" datepicker-options="dateOptions" ng-required="true"\n                            ng-model-options="{timezone: \'UTC\'}" ng-change="onChangeDatepicker()" readonly />\n                        <span class="input-group-btn">\n                            <button type="button" class="btn btn-default btn-sm" ng-click="openEndDate()"><i class="glyphicon glyphicon-calendar"></i></button>\n                        </span>\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="col-md-12 padding-search">\n        <div class="row">\n          <div class="date-picker-input">\n              <form ng-submit="onSubmitDateText()">\n                    <div class="form-group">\n                        <div class="col-xs-12">\n                            <div class="row searchtext" ng-class="{\'searchtext-focus\': focus}">\n                                <span class="input-group searchinputfield" id="searchinput">\n                                    <input class="md-input input-sm" type="text" ng-keyup="onKeyPress($event)" ng-model="dateString" ng-blur="focus=false" ng-focus="focus=true">\n                                    <span ng-click="doSearch()" class="input-group-addon border-search">\n                                        <i class="glyphicon glyphicon-search"></i>\n                                    </span>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n              </form>\n\n          </div>\n        </div>\n    </div>\n')}]),angular.module("components/geospatialFilter/geospatialFilter.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/geospatialFilter/geospatialFilter.tpl.html",'<div class="col-xs-12 padding-search">\n    <div class="input-group row searchtext searchinputfield" id="geospatialfilterinput" ng-class="{\'searchtext-focus\': focus}">\n        <input ng-model="filter.geo" ng-keypress="onKeyPress($event)" ng-click="onFocus()"\n        class="md-input" type="text" ng-keyup="onKeyPress($event)" ng-blur="focus=false" ng-focus="focus=true">\n        <span ng-click="doSearch()" class="input-group-addon border-search">\n            <i class="glyphicon glyphicon-search"></i>\n        </span>\n    </div>\n</div>\n')}]),angular.module("components/heatmap/heatmap.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/heatmap/heatmap.tpl.html",'<!-- the ol3 map -->\n<div class="map heatmap" id="map"></div>\n<div id="tooltip" style="display: none"></div>\n')}]),angular.module("components/histogram/histogram.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/histogram/histogram.tpl.html",'<div class="col-md-12 component-padding"\n    ng-style="{\'visibility\': yLegendRange.length ? \'visible\' : \'hidden\'}"\n    style="padding: 0px 0px; margin-left: 30px; width: {{histogramBarsDimensions.histogrambarsWidth}}px">\n    <div class="y-legend" style="height: {{histogramBarsDimensions.barsheight}}px;">\n        <ul class="histogram-legend list-unstyled">\n            <li ng-repeat="y in yLegendRange track by $index">{{y}}</li>\n        </ul>\n    </div>\n    <div style="height: {{histogramBarsDimensions.barsheight}}px;" class="y-axis-wrap">\n        <rzslider class="y-axis" rz-slider-model="Yaxis.minValue" rz-slider-high="Yaxis.maxValue" rz-slider-options="Yaxis.options"></rzslider>\n    </div>\n\n    <div class="bar-graph" id="{{barId}}" ng-class="{disabled: slider.options.disabled}"></div>\n    <rzslider rz-slider-model="slider.minValue" rz-slider-high="slider.maxValue" rz-slider-options="slider.options"></rzslider>\n    <legend-histogram dimensions="histogramBarsDimensions"></legend-histogram>\n</div>\n')}]),angular.module("components/histogram/legend.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/histogram/legend.tpl.html",'<div class="histogram-legend" style="padding-left: {{paddingBar}}px;">\n    <div ng-repeat="legend in legendList track by $index" style="width: {{legendWidth}}px;float:left">\n        <div class="legend-ticks "></div>\n        <div>{{legend}}</div>\n    </div>\n</div>\n')}]),angular.module("components/keyword/keyword.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/keyword/keyword.tpl.html",'<div class="md-chips">\n    <span>{{tag}}</span>\n    <button ng-click="removefn({keyword: tag})" ng-if="removeTag">&times;</button>\n</div>\n')}]),angular.module("components/keywordInput/keywordInput.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/keywordInput/keywordInput.tpl.html",'<div class="col-xs-12 padding-search">\n    <div class="row searchtext" ng-class="{\'searchtext-focus\': focus}">\n        <keyword removefn="removeKeyWord(keyword)" ng-repeat="keywordFilter in filterArray track by $index" remove="true" tag="{{keywordFilter}}"></keyword>\n        <span class="input-group searchinputfield" id="searchinput">\n             <input class="md-input" type="text" placeholder="{{placeholder}}" ng-keyup="onKeyPress($event)"\n              ng-model="textSearchInput.value" ng-blur="focus=false" ng-focus="focus=true">\n            <span ng-click="doSearch()" class="input-group-addon border-search">\n                <i class="glyphicon glyphicon-search"></i>\n            </span>\n        </span>\n    </div>\n</div>\n<div class="col-xs-12 padding-search" style="padding-top: 10px; padding-bottom: 6px;">\n    <div class="btn-group pull-left">\n        <label class="btn btn-default btn-xs btn-tag" ng-class="{active: tagSwitch.value}">\n            <input type="checkbox" autocomplete="off" ng-model="tagSwitch.value" ng-change="toggleSuggestKeywords()" ng-disabled="tagSwitch.disable"> Suggestions\n        </label>\n    </div>\n    <keyword  ng-repeat="keyword in suggestedKeywords" class="keyword-min"\n        ng-click="addSuggestedKeywordToSearchInput(keyword.value)" remove="false" tag="{{keyword.value}}"></keyword>\n</div>\n')}]),angular.module("components/modalTweets/modalTweets.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/modalTweets/modalTweets.tpl.html",'<!-- Modal -->\n<div class="modal fade" id="closesttweets" tabindex="-1">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n        </button>\n        <h4 class="modal-title" id="myModalLabel">\n            Closest tweets from [ {{coordinate[0] | number: 3}}, {{coordinate[1] | number: 3}} ]\n        </h4>\n      </div>\n      <div class="modal-body">\n          <div class="tweet-component">\n              <li ng-repeat="tweet in closestTweets" class="tweet" ng-click="sendToTweetStatus(tweet)">\n                <div class="list-item-text">\n                  <h3>@{{tweet.user_name}}</h3>\n                  <h4>{{tweet.text}}</h4>\n                  <p>{{tweet.created_at | date:\'medium\'}}</p>\n                </div>\n              </li>\n          </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("components/responsiveView/responsiveView.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/responsiveView/responsiveView.tpl.html",'<div class="top-panel"></div>\n<div class="left-panel"></div>\n<!-- min: 1200 -->\n\n<div class="container-fluid" ng-if="fullscreen">\n    <div class="row">\n        <div class="container col-400-12 col-800-6 col-1200-4">\n            <card-wrapper>\n                <toolbar-search number-keywords="10"></toolbar-search>\n            </card-wrapper>\n\n            <card-wrapper>\n                <user-filter></user-filter>\n            </card-wrapper>\n\n            <card-wrapper class="tweetlist-lg">\n                <tweetlist></tweetlist>\n            </card-wrapper>\n\n            <button-panel></button-panel>\n        </div>\n\n        <div class="container col-400-12 col-800-12 col-1200-8 col-1600-9">\n            <div class="row">\n                <div class="container col-400-12 col-1200-8 col-1600-6 time-components-lg">\n                    <div class="row">\n                        <div class="container col-400-12 col-1600-3">\n                            <card-wrapper>\n                                <date-picker></date-picker>\n                            </card-wrapper>\n                        </div>\n                        <div class="container col-400-12 col-1600-3">\n                            <card-wrapper>\n                                <time-histogram barId="inbar"></time-histogram>\n                            </card-wrapper>\n                        </div>\n                    </div>\n                </div>\n                <div class="container col-400-12 col-1600-3">\n                        <tweet-panel></tweet-panel>\n                </div>\n            </div>\n        </div>\n\n    </div>\n</div>\n\n<!-- min: 800px and max:1200 -->\n\n<div class="container-fluid" ng-if="!fullscreen">\n    <div class="row">\n       <div class="container col-400-12 col-800-6 col-1200-4 sidebar-tools-md">\n           <card-wrapper>\n               <toolbar-search number-keywords="10"></toolbar-search>\n           </card-wrapper>\n\n           <card-wrapper>\n               <user-filter></user-filter>\n           </card-wrapper>\n\n            <card-wrapper>\n                <date-picker></date-picker>\n            </card-wrapper>\n\n            <card-wrapper>\n                <time-histogram barId="inbar"></time-histogram>\n            </card-wrapper>\n\n            <card-wrapper>\n                <tweetlist></tweetlist>\n            </card-wrapper>\n\n            <tweet-panel></tweet-panel>\n\n            <button-panel></button-panel>\n       </div>\n    </div>\n</div>\n\n<modal-tweets></modal-tweets>\n')}]),angular.module("components/toolbarSearch/toolbarSearchField.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/toolbarSearch/toolbarSearchField.tpl.html",'<div class="col-xs-12 padding-search">\n    <div class="row toolbarsearch" ng-class="{\'searchtext-focus\': focus}">\n        <keyword removefn="removeKeyWord(keyword)" ng-repeat="keywordFilter in filterArray track by $index" remove="true" tag="{{keywordFilter}}"></keyword>\n        <span class="input-group searchinputfield" id="searchinput">\n            <input class="md-input" type="text" placeholder="Enter keyword" ng-keyup="onKeyPress($event)"\n              ng-model="textSearchInput.value" ng-blur="focus=false" ng-focus="focus=true">\n            <span ng-click="doSearch()" class="input-group-addon border-search">\n                <i class="glyphicon glyphicon-search"></i>\n            </span>\n        </span>\n\n     </div>\n</div>\n<div class="col-xs-12 padding-search" style="padding-top: 10px; padding-bottom: 6px;">\n    <div class="btn-group pull-left">\n        <label class="btn btn-default btn-xs btn-tag" ng-class="{active: tagSwitch.value}">\n            <input type="checkbox" autocomplete="off" ng-model="tagSwitch.value" ng-change="toggleSuggestKeywords()" ng-disabled="tagSwitch.disable"> Suggestions\n        </label>\n    </div>\n    <keyword  ng-repeat="keyword in suggestedKeywords" class="keyword-min"\n        ng-click="addSuggestedKeywordToSearchInput(keyword.value)" remove="false" tag="{{keyword.value}}"></keyword>\n</div>\n')}]),angular.module("components/tweetlist/counter.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/tweetlist/counter.tpl.html",'<div class="count-padding">\n    <p ng-show="counter">Results for keyword: {{counter}}</p>\n</div>\n')}]),angular.module("components/tweetlist/tweetlist.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/tweetlist/tweetlist.tpl.html",'<div class="row">\n    <div style="max-height: {{availableHeight}}px;" class="tweet-component">\n        <li ng-repeat="tweet in tweetList" class="tweet" ng-mouseleave="removeAllfeatures()"\n            ng-mouseenter="selectTweet(tweet)" ng-click="sendToTweetStatus(tweet)">\n          <div class="list-item-text">\n            <h3>@{{tweet.user_name}}</h3>\n            <h4>{{tweet.text}}</h4>\n            <p>{{tweet.created_at | date:\'medium\'}}</p>\n          </div>\n        </li>\n        <div ng-if="!tweetList.length && tweetList.exist" class="no-info">\n            No Tweets Available\n        </div>\n    </div>\n    <tweet-counter></tweet-counter>\n</div>\n')}]),angular.module("components/tweetlist/tweetPanel.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/tweetlist/tweetPanel.tpl.html",'<dl class="dl-horizontal list-group tweet-detail-panel" ng-if="!panelEmpty">\n<div class="list-group-item">\n    <dt>Id</dt>\n    <dd >{{selectedTweet.id}}</dd>\n</div>\n<div class="list-group-item">\n    <dt>Created at</dt>\n    <dd>{{selectedTweet.created_at}}</dd>\n</div>\n<div class="list-group-item">\n    <dt>Coord</dt>\n    <dd>{{selectedTweet.coord}}</dd>\n</div>\n<div class="list-group-item">\n    <dt>User Name</dt>\n    <dd>{{selectedTweet.user_name}}</dd>\n</div>\n</dl>\n')}]);